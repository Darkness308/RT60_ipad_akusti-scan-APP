{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "2.0.0",
  "description": "Configuration for Self-Healing CI system with intelligent auto-fix",

  "settings": {
    "max_heal_attempts": 5,
    "retry_delay_seconds": 30,
    "escalation_enabled": true,
    "auto_close_on_success": true,
    "create_pr_for_fixes": false,
    "notify_on_escalation": true,
    "verify_before_commit": true,
    "auto_trigger_ci": true
  },

  "error_patterns": {
    "import-error": {
      "patterns": [
        "import iPadScannerApp",
        "import OldModule",
        "No such module",
        "cannot find module"
      ],
      "files_to_check": [
        "**/*Tests.swift",
        "**/Sources/**/*.swift"
      ],
      "auto_fix_strategy": "fix_imports",
      "priority": "critical",
      "can_auto_fix": true
    },

    "pdf_test_failure": {
      "patterns": [
        "PDFRobustnessTests",
        "ReportContractTests",
        "PDF fehlt",
        "PDF missing",
        "required frequency",
        "required DIN",
        "core token"
      ],
      "files_to_check": [
        "Modules/Export/Sources/ReportExport/PDFReportRenderer.swift",
        "Modules/Export/Sources/ReportExport/ReportHTMLRenderer.swift"
      ],
      "auto_fix_strategy": "ensure_required_elements",
      "priority": "high",
      "can_auto_fix": true
    },

    "type-error": {
      "patterns": [
        "cannot find type",
        "undeclared type",
        "has no member"
      ],
      "auto_fix_strategy": "fix_type_references",
      "priority": "high",
      "can_auto_fix": false
    },

    "build_failure": {
      "patterns": [
        "error: cannot find",
        "error: use of undeclared",
        "error: missing required",
        "Build failed",
        "Compilation failed"
      ],
      "auto_fix_strategy": "clean_rebuild",
      "priority": "high",
      "can_auto_fix": true
    },

    "lint_failure": {
      "patterns": [
        "SwiftLint",
        "swiftformat",
        "trailing whitespace",
        "line length",
        "indentation"
      ],
      "auto_fix_strategy": "run_formatters",
      "priority": "medium",
      "can_auto_fix": true
    },

    "dependency_failure": {
      "patterns": [
        "package resolution failed",
        "dependency graph",
        "version solving failed"
      ],
      "auto_fix_strategy": "clean_resolve",
      "priority": "medium",
      "can_auto_fix": true
    },

    "test_timeout": {
      "patterns": [
        "Test timed out",
        "exceeded time limit"
      ],
      "auto_fix_strategy": "increase_timeout",
      "priority": "low",
      "can_auto_fix": false
    }
  },

  "fix_strategies": {
    "fix_imports": {
      "description": "Fix broken or outdated module imports",
      "steps": [
        "find_files_with_bad_imports",
        "replace_module_names",
        "fix_class_references",
        "verify_compilation"
      ],
      "replacements": {
        "iPadScannerApp": "AcoustiScanConsolidated",
        "RT60Calculation": "RT60Calculator"
      }
    },

    "ensure_required_elements": {
      "description": "Ensure all required PDF/HTML elements are present",
      "steps": [
        "verify_core_tokens",
        "verify_required_frequencies",
        "verify_din_values",
        "verify_default_metadata"
      ]
    },

    "clean_rebuild": {
      "description": "Clean build artifacts and rebuild",
      "steps": [
        "clean_derived_data",
        "clean_build_folder",
        "resolve_packages",
        "rebuild"
      ]
    },

    "run_formatters": {
      "description": "Run code formatters to fix style issues",
      "steps": [
        "run_swiftformat",
        "run_swiftlint_fix"
      ]
    },

    "clean_resolve": {
      "description": "Clean and re-resolve dependencies",
      "steps": [
        "remove_package_resolved",
        "clean_caches",
        "resolve_packages"
      ]
    }
  },

  "required_elements": {
    "frequencies": [125, 1000, 4000],
    "din_values": [0.6, 0.5, 0.48],
    "core_tokens": [
      "rt60 bericht",
      "metadaten",
      "ger√§t",
      "ipadpro",
      "version",
      "1.0.0"
    ],
    "default_device": "ipadpro",
    "default_version": "1.0.0"
  },

  "escalation": {
    "labels": ["bug", "ci-failure", "needs-human", "priority-high"],
    "assignees": [],
    "notify_channels": [],
    "template": "human_intervention_required"
  },

  "ai_agents": {
    "autofix_engine": {
      "enabled": true,
      "script": ".github/scripts/autofix-engine.sh",
      "capabilities": ["import_fix", "lint_fix", "dependency_fix", "build_fix"]
    },
    "copilot": {
      "enabled": true,
      "trigger": "@copilot",
      "capabilities": ["code_fix", "test_fix", "refactor"]
    },
    "claude": {
      "enabled": true,
      "trigger": "@claude",
      "capabilities": ["code_fix", "test_fix", "analysis", "documentation"]
    }
  }
}
